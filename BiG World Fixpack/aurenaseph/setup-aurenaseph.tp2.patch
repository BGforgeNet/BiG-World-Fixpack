--- aurenaseph\setup-aurenaseph.tp2	Wed Oct 02 09:40:08 2013
+++ D:\EE_Patchstudio\patched files\aurenaseph\setup-aurenaseph.tp2	Wed Jan 20 19:35:56 2016
@@ -2,10 +2,55 @@
 AUTHOR ~theacefes (theacefes@gibberlings3.net)~
 README ~AurenAseph/Readme-Auren.html~
 
-AUTO_TRA ~AurenAseph\%s~
+AUTO_TRA "AurenAseph\%s"//%"
 
 VERSION v8
 
+ALWAYS
+
+	ACTION_IF "%WEIDU_OS%" STRING_EQUAL_CASE ~win32~ BEGIN
+		AT_NOW ~if not exist "iconv" mkdir iconv~
+		AT_NOW ~if not exist "iconv\iconv.exe" copy "BiG World Fixpack\_utils\iconv" "iconv"~
+	END
+  
+	ACTION_DEFINE_ASSOCIATIVE_ARRAY tra#charsets BEGIN
+    english => cp1252
+	british => cp1252
+    french => cp1252
+    spanish => cp1252
+    russian => cp1251
+    german => cp1252
+	italian => cp1252
+    polish => cp1250
+    schinese => cp936
+	END
+	
+	ACTION_DEFINE_ARRAY tra#reload BEGIN setup END
+	ACTION_DEFINE_ARRAY tra#noconvert BEGIN END
+
+	LAF HANDLE_CHARSETS
+		INT_VAR
+			infer_charset = 0
+		STR_VAR
+			tra_path = EVAL ~AurenAseph~
+			charset_table = tra#charsets
+			noconvert_array = tra#noconvert
+			reload_array = tra#reload
+			iconv_path = ~iconv~
+	END
+	
+  ACTION_IF (GAME_IS ~eet~) AND (FILE_CONTAINS ~override/EET.flag~ ~EET_JOURNAL~) BEGIN
+    OUTER_SET bg2_chapter = 14
+  END ELSE BEGIN
+    OUTER_SET bg2_chapter = 0
+  END
+  OUTER_FOR (i=1; i<=10; i=i+1) BEGIN
+    OUTER_SET bg2_chapter = bg2_chapter + 1
+    OUTER_SPRINT name_source ~bg2_chapter_%i%~
+    OUTER_SET EVAL ~%name_source%~ = bg2_chapter
+  END
+END
+
 LANGUAGE ~English~
          ~English~
          ~AurenAseph\English\Setup.tra~
@@ -143,9 +188,9 @@
 
 // Adds Dialogue Files
 
-COMPILE ~AurenAseph/Dialogues/K#Auren.d~
-COMPILE ~AurenAseph/Dialogues/K#AurenB.d~
-COMPILE ~AurenAseph/Dialogues/K#AurenJ.d~
+COMPILE EVALUATE_BUFFER ~AurenAseph/Dialogues/K#Auren.d~
+COMPILE EVALUATE_BUFFER ~AurenAseph/Dialogues/K#AurenB.d~
+COMPILE EVALUATE_BUFFER ~AurenAseph/Dialogues/K#AurenJ.d~
 COMPILE ~AurenAseph/Dialogues/K#Valin.d~
 
 // Adds Items
@@ -158,29 +203,29 @@
 
 // Adds Scripts
 
-COMPILE ~AurenAseph/Scripts/K#Auren.baf~ USING ~AurenAseph/%s/scripts.tra~
+COMPILE EVALUATE_BUFFER ~AurenAseph/Scripts/K#Auren.baf~ USING ~AurenAseph/%s/scripts.tra~
 COMPILE ~AurenAseph/Scripts/K#Valin.baf~
 COMPILE ~AurenAseph/Scripts/K#Arian.baf~
 EXTEND_BOTTOM ~Ar0406.bcs~ ~AurenAseph/Scripts/ar0406.baf~
-EXTEND_BOTTOM ~Ar0300.bcs~ ~AurenAseph/Scripts/ar0300.baf~
-EXTEND_BOTTOM ~Ar0509.bcs~ ~AurenAseph/Scripts/ar0509.baf~
-EXTEND_BOTTOM ~Ar0701.bcs~ ~AurenAseph/Scripts/ar0701.baf~
-EXTEND_BOTTOM ~Ar1000.bcs~ ~AurenAseph/Scripts/ar1000.baf~
-EXTEND_BOTTOM ~Ar1100.bcs~ ~AurenAseph/Scripts/ar1100.baf~
-EXTEND_BOTTOM ~Ar2001.bcs~ ~AurenAseph/Scripts/ar2001.baf~
-EXTEND_BOTTOM ~Ar2007.bcs~ ~AurenAseph/Scripts/ar2007.baf~
-EXTEND_BOTTOM ~Ar0900.bcs~ ~AurenAseph/Scripts/ar0900.baf~
-EXTEND_BOTTOM ~Ar1600.bcs~ ~AurenAseph/Scripts/ar1600.baf~
-EXTEND_BOTTOM ~Ar2010.bcs~ ~AurenAseph/Scripts/ar2010.baf~
-EXTEND_BOTTOM ~Ar1900.bcs~ ~AurenAseph/Scripts/ar1900.baf~
-EXTEND_BOTTOM ~Ar1202.bcs~ ~AurenAseph/Scripts/ar1202.baf~
-EXTEND_BOTTOM ~Ar0903.bcs~ ~AurenAseph/Scripts/ar0903.baf~
-EXTEND_BOTTOM ~Ar2600.bcs~ ~AurenAseph/Scripts/ar2600.baf~
-EXTEND_BOTTOM ~Ar0302.bcs~ ~AurenAseph/Scripts/ar0302.baf~
-EXTEND_BOTTOM ~Ar0404.bcs~ ~AurenAseph/Scripts/ar0404.baf~
-EXTEND_BOTTOM ~Ar0413.bcs~ ~AurenAseph/Scripts/ar0413.baf~
-EXTEND_BOTTOM ~Ar2812.bcs~ ~AurenAseph/Scripts/ar2812.baf~
-EXTEND_BOTTOM ~Ar2200.bcs~ ~AurenAseph/Scripts/ar2200.baf~
+EXTEND_BOTTOM ~Ar0300.bcs~ ~AurenAseph/Scripts/ar0300.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar0509.bcs~ ~AurenAseph/Scripts/ar0509.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar0701.bcs~ ~AurenAseph/Scripts/ar0701.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar1000.bcs~ ~AurenAseph/Scripts/ar1000.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar1100.bcs~ ~AurenAseph/Scripts/ar1100.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar2001.bcs~ ~AurenAseph/Scripts/ar2001.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar2007.bcs~ ~AurenAseph/Scripts/ar2007.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar0900.bcs~ ~AurenAseph/Scripts/ar0900.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar1600.bcs~ ~AurenAseph/Scripts/ar1600.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar2010.bcs~ ~AurenAseph/Scripts/ar2010.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar1900.bcs~ ~AurenAseph/Scripts/ar1900.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar1202.bcs~ ~AurenAseph/Scripts/ar1202.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar0903.bcs~ ~AurenAseph/Scripts/ar0903.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar2600.bcs~ ~AurenAseph/Scripts/ar2600.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar0302.bcs~ ~AurenAseph/Scripts/ar0302.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar0404.bcs~ ~AurenAseph/Scripts/ar0404.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar0413.bcs~ ~AurenAseph/Scripts/ar0413.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar2812.bcs~ ~AurenAseph/Scripts/ar2812.baf~ EVALUATE_BUFFER
+EXTEND_BOTTOM ~Ar2200.bcs~ ~AurenAseph/Scripts/ar2200.baf~ EVALUATE_BUFFER
 COMPILE ~AurenAseph/Scripts/K#WTF.baf~
 
 
@@ -286,7 +331,7 @@
 COMPILE ~AurenAseph/Dialogues/K#Aur25J.d~
 COMPILE ~AurenAseph/Dialogues/K#ValiT.d~
 COMPILE ~AurenAseph/Dialogues/K#AriaT.d~
-COMPILE ~AurenAseph/Dialogues/FATESP.d~
+
 COMPILE ~AurenAseph/Dialogues/K#Aur25D.d~
 COMPILE ~AurenAseph/Dialogues/K#AQ.d~
 
@@ -373,7 +418,7 @@
 
 // Adds Portraits
      
-ACTION_IF GAME_IS BG2EE THEN BEGIN
+ACTION_IF GAME_IS ~BG2EE eet~ THEN BEGIN
 
   COPY ~AurenAseph/portraits/aurens_ee.bmp~ ~override/aurens.bmp~
        ~AurenAseph/portraits/aurenm_ee.bmp~ ~override/aurenm.bmp~
@@ -387,11 +432,29 @@
 
 END
 
+ACTION_IF GAME_IS ~eet~ BEGIN
+  LOAD_TRA ~AurenAseph/%LANGUAGE%/fatesp.tra~
+  INCLUDE ~Angelo/EET_functions.tph~
+  LAF ~EET_NPC_TRANSITION~
+    INT_VAR
+      type = 2
+    STR_VAR
+      dv = "K#AUREN"
+      override_SoA = "K#AUREN"
+      override_ToB = "K#AURE25"
+      dialog_ToB = "K#AUR25D"
+      string = "@0" //Bring me Auren, the human fighter.
+      stringPosDV = "Anomen"
+  END
+END ELSE BEGIN
+  COMPILE ~AurenAseph/Dialogues/FATESP.d~
+END
+
 BEGIN @106
 SUBCOMPONENT @107
 REQUIRE_COMPONENT ~AurenAseph/Setup-AurenAseph.tp2~ ~0~ @108
      
-ACTION_IF GAME_IS BG2EE THEN BEGIN
+ACTION_IF GAME_IS ~BG2EE eet~ THEN BEGIN
 
   COPY ~AurenAseph/portraits/aurens_alt1_ee.bmp~ ~override/aurens.bmp~
        ~AurenAseph/portraits/aurenm_alt1_ee.bmp~ ~override/aurenm.bmp~
@@ -409,7 +472,7 @@
 SUBCOMPONENT @107
 REQUIRE_COMPONENT ~AurenAseph/Setup-AurenAseph.tp2~ ~0~ @108
 
-ACTION_IF GAME_IS BG2EE THEN BEGIN
+ACTION_IF GAME_IS ~BG2EE eet~ THEN BEGIN
 
   COPY ~AurenAseph/portraits/aurens_alt2_ee.bmp~ ~override/aurens.bmp~
        ~AurenAseph/portraits/aurenm_alt2_ee.bmp~ ~override/aurenm.bmp~
